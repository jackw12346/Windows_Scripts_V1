$safeTasksArray = @("MicrosoftEdgeUpdateTaskMachineCore", "MicrosoftEdgeUpdateTaskMachineUA", "OneDrive Reporting Task-S-1-5-21-1494450805-2701001687-2720580296-1001", "OneDrive Standalone Update Task-S-1-5-21-1494450805-2701001687-2720580296-1001", ".NET Framework NGEN v4.0.30319", ".NET Framework NGEN v4.0.30319 64", ".NET Framework NGEN v4.0.30319 64 Critical", ".NET Framework NGEN v4.0.30319 Critical", "AD RMS Rights Policy Template Management (Manual)", "EDP Policy Manager", "Microsoft Compatibility Appraiser", "PcaPatchDbTask", "ProgramDataUpdater", "StartupAppTask", "appuriverifierdaily", "appuriverifierinstall", "CleanupTemporaryState", "DsSvcCleanup", "Backup", "Pre-staged app cleanup", "Proxy", "BitLocker Encrypt All Drives", "BitLocker MDM policy Refresh", "UninstallDeviceTask", "BgTaskRegistrationMaintenanceTask", "AikCertEnrollTask", "CryptoPolicyTask", "KeyPreGenTask", "SystemTask", "UserTask", "UserTask-Roam", "ProactiveScan", "SyspartRepair", "CreateObjectTask", "Consolidator", "UsbCeip", "Data Integrity Check And Scan", "Data Integrity Scan", "Data Integrity Scan for Crash Recovery", "ScheduledDefrag", "Device", "Device User", "Metadata Refresh", "HandleCommand", "HandleWnsCommand", "IntegrityCheck", "LocateCommandUserSession", "RegisterDeviceAccountChange", "RegisterDevicePolicyChange", "RegisterDeviceProtectionStateChanged", "RegisterDeviceSettingChange", "RegisterUserDevice", "RecommendedTroubleshootingScanner", "Scheduled", "DirectXDatabaseUpdater", "DXGIAdapterCache", "SilentCleanup", "Microsoft-Windows-DiskDiagnosticDataCollector", "Diagnostics", "StorageSense", "dusmtask", "EDP App Launch Task", "EDP Auth Task", "EDP Inaccessible Credentials Task", "StorageCardEncryption Task", "ExploitGuard MDM policy Refresh", "DmClient", "DmClientOnScenarioDownload", "File History (maintenance mode)", "ReconcileFeatures", "UsageDataFlushing", "UsageDataReporting", "RefreshCache", "FODCleanupTask", "LocalUserSyncDataAvailable", "MouseSyncDataAvailable", "PenSyncDataAvailable", "TouchpadSyncDataAvailable", "ScanForUpdates", "ScanForUpdatesAsUser", "SmartRetry", "Synchronize Language Settings", "Installation", "ReconcileLanguageResources", "Uninstallation", "TempSignedLicenseExchange", "Notifications", "WindowsActionDialog", "WinSAT", "Cellular", "Logon", "MapsToastTask", "ProcessMemoryDiagnosticEvents", "RunFullMemoryDiagnostic", "MNO Metadata Parser", "LPRemove", "GatherNetworkInfo", "WiFiTask", "Secure-Boot-Update", "SecureBootEncodeUEFI", "Sqm-Tasks", "Device Install Group Policy", "Device Install Reboot Required", "Sysprep Generalize Drivers", "AnalyzeSystem", "EduPrintProv", "PrinterCleanupTask", "Registration", "MobilityManager", "VerifyWinRE", "RegIdleBackup", "RemoteAssistanceTask", "CleanupOfflineContent", "StartComponentCleanup", "BackgroundUploadTask", "NetworkStateChangeTask", "SetupCleanupTask", "CreateObjectTask", "FamilySafetyMonitor", "FamilySafetyRefreshTask", "IndexerAutomaticMaintenance", "ThemesSyncedImageDownload", "UpdateUserPictureTask", "SvcRestartTask", "SvcRestartTaskLogon", "SvcRestartTaskNetwork", "SpaceAgentTask", "SpaceManagerTask", "SpeechModelDownloadTask", "MaintenanceTasks", "Storage Tiers Management Initialization", "EnableLicenseAcquisition", "ResPriStaticDbSync", "WsSwapAssessmentTask", "SR", "Interactive", "MsCtfMonitor", "ForceSynchronizeTime", "SynchronizeTime", "SynchronizeTimeZone", "Tpm-HASCertRetr", "Tpm-Maintenance", "Report policies", "Schedule Scan", "Schedule Scan Static Task", "UpdateModelTask", "USO_UxBroker", "UPnPHostConfig", "Usb-Notifications", "WiFiTask", "ResolutionHost", "Windows Defender Cache Maintenance", "Windows Defender Cleanup", "Windows Defender Scheduled Scan", "Windows Defender Verification", "QueueReporting", "BfeOnServiceStartTypeChange", "UpdateLibrary", "Calibration Loader", "Scheduled Start", "CDSSync", "WIM-Hash-Management", "WIM-Hash-Validation", "Work Folders Logon Synchronization", "Work Folders Maintenance Work", "NotificationTask", "OobeDiscovery", "XblGameSaveTask", "AD RMS Rights Policy Template Management (Automated)", "PolicyConverter", "VerifiedPublisherCertStoreCheck", "License Validation", "LicenseImdsIntegration", "RegisterDeviceLocationRightsChange", "RegisterDevicePeriodic24", "Microsoft-Windows-DiskDiagnosticResolver", "Property Definition Sync", "WakeUpAndContinueUpdates", "WakeUpAndScanForUpdates", "DetectHardwareChange", "RemediateHardwareChange", "Retry", "RunOnReboot", "MapsUpdateTask", "SystemSoundsService", "Background Synchronization", "Logon Synchronization", "LoginCheck", "Account Cleanup", "Storage Tiers Optimization", "LicenseAcquisition", "HybridDriveCachePrepopulate", "HybridDriveCacheRebalance", "RunUpdateNotificationMgr", "Schedule Maintenance Work", "Schedule Wake To Work", "Schedule Work", "HiveUploadTask", "PerformRemediation", "CacheTask", "Automatic-Device-Join", "Device-Sync", "Recovery-Check")

$currentTasks = Get-ScheduledTask | ForEach-Object {$_.TaskName}

$potentialCompromisedTasks = $currentTasks | Where-Object {$_ -notin $safeTasksArray}

if ($potentialCompromisedTasks) {
    Write-Output "Found potentially compromised tasks:"
    $potentialCompromisedTasks | ForEach-Object {Write-Output $_}
} else {
    Write-Output "No potentially compromised tasks found."
}
